<% merkmalklassen = Merkmalklasse.includes(:merkmale).visibles(:host, 'index') %>
<div data-controller="datatables">
  <%= content_tag :table,
        id: 'vulnerability_details',
        class: "table table-bordered",
        data: {
          order: [[0, 'desc']].to_json
        } do %>

    <thead>
      <tr>
        <th><%= t('attributes.name') %></th>
        <th><%= t('attributes.description') %></th>
        <th><%= t('attributes.ip') %></th>
        <th><%= t('attributes.operating_system') %></th>
        <th><%= t('attributes.fqdn') %></th>
        <th><%= t('attributes.lastseen') %></th>
        <th><%= t('attributes.host_category') %></th>
        <th><%= t('attributes.location') %></th>
        <%= content_tag_for(:th, merkmalklassen) do |mklasse| %>
          <%= mklasse.to_s %>
        <% end %>
        <th class="nosort">Aktion</th>
      </tr>
    </thead>
    <tfoot class="nosearch">
      <tr>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <%= content_tag_for(:th, merkmalklassen) do |mklasse| %>
        <% end %>
        <th class="nosearch"></th>
      </tr>
    </tfoot>
    <tbody>
  <% hosts.each do |host| %>
    <%= content_tag_for(:tr, host) do %>
      <td><%= host.name %></td>
      <td><%= host.description %></td>
      <td><%= link_to host.ip.to_s, host_path(host) %></td>
      <td><%= host.operating_system.to_s %></td>
      <td><%= host.fqdn %></td>
      <td><%= host.vulnerabilities.where(vulnerability_detail_id: @vulnerability_detail.id)&.first&.lastseen %></td>
      <td><%= host.host_category.to_s %></td>
      <td><%= host.location&.lid %></td>
      <%= content_tag_for(:td, merkmalklassen) do |mklasse| %>
        <%= get_merkmal(host, mklasse) %>
      <% end %>
      <td class="nowrap">
        <%= show_link host %>
      </td>
    <% end %>
  <% end %>

    </tbody>
  <% end %>
</div>
