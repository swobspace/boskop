class Vulnerability < ApplicationRecord
  # -- associations
  belongs_to :host
  belongs_to :vulnerability_detail
  has_one :location, through: :host, inverse_of: :vulnerabilities
  has_one :operating_system, through: :host, inverse_of: :vulnerabilities
  has_one :host_category, through: :host, inverse_of: :vulnerabilities

  # -- configuration
  # -- validations and callbacks
  validates :lastseen, presence: true

  def to_s
    "#{vulnerability_detail&.name}"
  end

  scope :high, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: 'High' })
  }

end
