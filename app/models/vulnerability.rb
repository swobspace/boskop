class Vulnerability < ApplicationRecord
  # -- associations
  belongs_to :host
  belongs_to :vulnerability_detail
  has_one :location, through: :host, inverse_of: :vulnerabilities
  has_one :operating_system, through: :host, inverse_of: :vulnerabilities
  has_one :host_category, through: :host, inverse_of: :vulnerabilities

  # -- configuration
  # -- validations and callbacks
  validates :lastseen, presence: true

  def to_s
    "#{vulnerability_detail&.name}"
  end

  scope :higher, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: ['High', 'Critical'] })
  }
  scope :critical, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: ['Critical'] })
  }
  scope :high, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: ['High'] })
  }
  scope :medium, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: ['Medium'] })
  }
  scope :low, -> {
    joins(:vulnerability_detail).where(vulnerability_details: {threat: ['Low'] })
  }

end
