require 'csv'

module VulnerabilityConcerns
  extend ActiveSupport::Concern

  included do
    def self.to_csv(options = {})
      CSV.generate(options) do |csv|
        csv << [ 
                I18n.t('attributes.lid'),
		I18n.t('attributes.host'),
		I18n.t('attributes.ip'),
		I18n.t('attributes.host_category'),
		I18n.t('attributes.operating_system'),
		I18n.t('attributes.vulnerability_detail'),
		I18n.t('attributes.threat'),
		I18n.t('attributes.severity'),
		I18n.t('attributes.lastseen'),
               ]
        all.each do |vuln|
          csv << [ 
		  vuln.host&.location&.lid,
		  vuln.host.name,
		  vuln.host.ip.to_s,
		  vuln.host&.host_category.to_s,
		  vuln.host&.operating_system.to_s,
		  vuln.vulnerability_detail.to_s,
		  vuln.vulnerability_detail.threat,
		  vuln.vulnerability_detail.severity,
		  vuln.lastseen,
                 ]
        end # all.each
      end # CSV
    end # self.to_csv
  end # included do

end

