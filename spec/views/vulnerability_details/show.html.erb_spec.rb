require 'rails_helper'

RSpec.describe "vulnerability_details/show", type: :view do
  before(:each) do
    @ability = Object.new
    @ability.extend(CanCan::Ability)
    allow(controller).to receive(:current_ability) { @ability }
    allow(controller).to receive(:controller_name) { "vulnerability_details" }
    allow(controller).to receive(:action_name) { "edit" }

    @vulnerability_detail = assign(:vulnerability_detail, VulnerabilityDetail.create!(
      :name => "Name",
      :nvt => "Nvt",
      :family => "Family",
      :threat => "Threat",
      :severity => "9.99",
      :cves => ["CVE-123", "CVE-456"],
      :bids => ["124", "457"],
      :xrefs => ["URL:hellothere", "URL:hithis"],
      :notes  => {"summary" => "a short summary"},
      :certs => [ {id: "DFN-CERT-123", type: "DFN-CERT"} ]
    ))
  end

  it "renders attributes in <p>" do
    render
    expect(rendered).to match(/Name/)
    expect(rendered).to match(/Nvt/)
    expect(rendered).to match(/Family/)
    expect(rendered).to match(/Threat/)
    expect(rendered).to match(/9.99/)
    expect(rendered).to match(/CVE-123/)
    expect(rendered).to match(/CVE-456/)
    expect(rendered).to match(/124/)
    expect(rendered).to match(/457/)
    expect(rendered).to match(/hellothere/)
    expect(rendered).to match(/hithis/)
    expect(rendered).to match(/a short summary/)
    expect(rendered).to match(/DFN-CERT-123/)
  end
end
